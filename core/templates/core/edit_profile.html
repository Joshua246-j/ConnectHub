{% load static %}
{% extends "core/base.html" %}
{% block content %}

<div
  class="max-w-lg mx-auto bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-lg space-y-8 mt-8"
>
  <!-- ðŸ–¼ Profile Picture Preview -->
  <div class="flex flex-col items-center space-y-3">
    <div class="relative">
      {% if user.profile and user.profile.profile_pic %}
      <img
        id="profilePreview"
        src="{{ user.profile.profile_pic.url }}"
        class="w-28 h-28 rounded-full object-cover border-4 border-gray-200 dark:border-gray-700 shadow-md"
        alt="Profile Picture"
      />
      {% else %}
      <img
        id="profilePreview"
        src="{% static 'images/default-avatar.png' %}"
        class="w-28 h-28 rounded-full object-cover border-4 border-gray-200 dark:border-gray-700 shadow-md"
        alt="Default Profile Picture"
      />
      {% endif %}
      <label
        for="id_profile_pic"
        class="absolute bottom-0 right-0 bg-blue-600 hover:bg-blue-700 text-white rounded-full p-2 shadow cursor-pointer transition"
      >
        <!-- Camera Icon -->
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15.232 5.232l3.536 3.536M9 13h3l8-8-3-3-8 8v3zM3 21h18"
          />
        </svg>
      </label>
    </div>
    <p class="text-sm text-gray-500 dark:text-gray-400">
      Tap icon to change your profile picture
    </p>
  </div>

  <!-- ðŸ“ Page Title -->
  <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100 text-center">
    Edit Profile
  </h2>

  <!-- âš ï¸ Error Messages -->
  {% if form.errors %}
  <div
    class="bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 p-4 rounded-xl text-sm"
  >
    <ul class="list-disc list-inside space-y-1">
      {% for field in form %}
        {% for error in field.errors %}
          <li><strong>{{ field.label }}:</strong> {{ error }}</li>
        {% endfor %}
      {% endfor %}
      {% for error in form.non_field_errors %}
        <li>{{ error }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <!-- ðŸ–Šï¸ Form -->
  <form method="post" enctype="multipart/form-data" class="space-y-5">
    {% csrf_token %}

    <!-- Hide Default File Input -->
    <input
      type="file"
      id="id_profile_pic"
      name="profile_pic"
      accept="image/*"
      class="hidden"
    />

    {% for field in form %}
      {% if field.name != "profile_pic" %}
      <div class="space-y-1">
        <label
          for="{{ field.id_for_label }}"
          class="block text-sm font-medium text-gray-700 dark:text-gray-300"
        >
          {{ field.label }}
        </label>
        {{ field }}
        {% if field.help_text %}
        <p class="text-xs text-gray-500 dark:text-gray-400">
          {{ field.help_text }}
        </p>
        {% endif %}
      </div>
      {% endif %}
    {% endfor %}

    <!-- Submit Button -->
    <button
      type="submit"
      class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl shadow-md transition duration-200"
    >
      ðŸ’¾ Save Changes
    </button>
  </form>
</div>

<!-- âœ… GLOBAL STYLE FIX FOR DARK MODE -->
<style>
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"],
  textarea,
  select {
    width: 100%;
    padding: 0.75rem;
    border-radius: 0.75rem;
    border: 1px solid var(--border-color, #d1d5db);
    background-color: white;
    color: black;
    outline: none;
    transition: all 0.2s ease-in-out;
  }
  html.dark input[type="text"],
  html.dark input[type="email"],
  html.dark input[type="password"],
  html.dark input[type="number"],
  html.dark textarea,
  html.dark select {
    background-color: #374151 !important;
    color: #f9fafb !important;
    border-color: #4b5563 !important;
  }
  html.dark input::placeholder,
  html.dark textarea::placeholder {
    color: #9ca3af !important;
  }
  input[type="radio"] {
    accent-color: #2563eb;
  }
  html.dark input[type="radio"] {
    accent-color: #3b82f6;
  }
</style>

<script>
  const profileInput = document.getElementById("id_profile_pic");
  const profilePreview = document.getElementById("profilePreview");

  if (profileInput) {
    profileInput.addEventListener("change", function (event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          profilePreview.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });
  }
</script>

{% endblock %}
